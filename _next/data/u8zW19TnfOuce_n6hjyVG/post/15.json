{"pageProps":{"post":{"url":"https://api.github.com/repos/minecode/minecode.github.io/issues/15","repository_url":"https://api.github.com/repos/minecode/minecode.github.io","labels_url":"https://api.github.com/repos/minecode/minecode.github.io/issues/15/labels{/name}","comments_url":"https://api.github.com/repos/minecode/minecode.github.io/issues/15/comments","events_url":"https://api.github.com/repos/minecode/minecode.github.io/issues/15/events","html_url":"https://github.com/minecode/minecode.github.io/issues/15","id":603477264,"node_id":"MDU6SXNzdWU2MDM0NzcyNjQ=","number":15,"title":"[POST] ReactJS + Github-Pages com deploy automático","user":{"login":"cfchenr","id":17366849,"node_id":"MDQ6VXNlcjE3MzY2ODQ5","avatar_url":"https://avatars.githubusercontent.com/u/17366849?v=4","gravatar_id":"","url":"https://api.github.com/users/cfchenr","html_url":"https://github.com/cfchenr","followers_url":"https://api.github.com/users/cfchenr/followers","following_url":"https://api.github.com/users/cfchenr/following{/other_user}","gists_url":"https://api.github.com/users/cfchenr/gists{/gist_id}","starred_url":"https://api.github.com/users/cfchenr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cfchenr/subscriptions","organizations_url":"https://api.github.com/users/cfchenr/orgs","repos_url":"https://api.github.com/users/cfchenr/repos","events_url":"https://api.github.com/users/cfchenr/events{/privacy}","received_events_url":"https://api.github.com/users/cfchenr/received_events","type":"User","site_admin":false},"labels":[{"id":2001374527,"node_id":"MDU6TGFiZWwyMDAxMzc0NTI3","url":"https://api.github.com/repos/minecode/minecode.github.io/labels/CI/CD","name":"CI/CD","color":"a53009","default":false,"description":""},{"id":2001373674,"node_id":"MDU6TGFiZWwyMDAxMzczNjc0","url":"https://api.github.com/repos/minecode/minecode.github.io/labels/Github%20Actions","name":"Github Actions","color":"f9d0c4","default":false,"description":""},{"id":2001373856,"node_id":"MDU6TGFiZWwyMDAxMzczODU2","url":"https://api.github.com/repos/minecode/minecode.github.io/labels/Github%20Pages","name":"Github Pages","color":"45e0ac","default":false,"description":""},{"id":2001374136,"node_id":"MDU6TGFiZWwyMDAxMzc0MTM2","url":"https://api.github.com/repos/minecode/minecode.github.io/labels/React","name":"React","color":"a1ea69","default":false,"description":""},{"id":2001374334,"node_id":"MDU6TGFiZWwyMDAxMzc0MzM0","url":"https://api.github.com/repos/minecode/minecode.github.io/labels/ReactJS","name":"ReactJS","color":"5de2ce","default":false,"description":""},{"id":2001020663,"node_id":"MDU6TGFiZWwyMDAxMDIwNjYz","url":"https://api.github.com/repos/minecode/minecode.github.io/labels/highlight","name":"highlight","color":"ead152","default":false,"description":""},{"id":1923405712,"node_id":"MDU6TGFiZWwxOTIzNDA1NzEy","url":"https://api.github.com/repos/minecode/minecode.github.io/labels/post","name":"post","color":"2dc64e","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2020-04-20T19:26:18Z","updated_at":"2020-04-21T07:35:13Z","closed_at":"2020-04-20T20:35:56Z","author_association":"MEMBER","active_lock_reason":null,"body":"# Introdução\r\n\r\nNeste artigo vou explicar como podem correr uma aplicação **ReactJS** nas páginas do **Github** (<github user>.github.io) e automatizar o deploy sempre que houverem alterações no código fonte da aplicação.\r\n\r\n![how-to-setup-continuous-integration-and-deployment-workflows-for-reactjs-using-github-actions-3dcebd2ae722381739d8b6d98c7d934f](https://user-images.githubusercontent.com/17366849/79797105-9775f800-834e-11ea-8721-e5680fe5fcc5.jpg)\r\n\r\n# Criar a aplicação **ReactJS**\r\n\r\nO primeiro passo é criarmos a nossa aplicação **ReactJS**. Para tal executamos os seguintes comandos:\r\n\r\n```{bash}\r\nnpx create-react-app my-app\r\ncd my-app\r\nnpm start\r\n```\r\n\r\n![3](https://user-images.githubusercontent.com/17366849/79790603-e66a6000-8343-11ea-962d-55404c85bb2a.png)\r\n\r\nPara verificar que está tudo a correr como esperado, acedemos ao url http://localhost:3000 e verificamos se a resposta da aplicação é idêntica à representada na seguinte figura:\r\n\r\n![1](https://user-images.githubusercontent.com/17366849/79788218-32b3a100-8340-11ea-8355-31d51dec6228.png)\r\n\r\nDe forma a conseguirmos ligar a aplicação **ReactJS** ao sistema de páginas do **Github** instalamos a dependência gh-pages:\r\n\r\n```{bash}\r\nnpm install gh-pages --save-dev\r\n```\r\n\r\n![4](https://user-images.githubusercontent.com/17366849/79791145-bbccd700-8344-11ea-99cc-046e2b360f0d.png)\r\n\r\nAgora que temos a nossa aplicação a correr sem problemas vamos alterar algumas configurações essênciais no ficheiro **package.json**:\r\n\r\n- Adicionar a chave **homepage**:\r\n\r\n```{json}\r\n//...\r\n\"homepage\": \"http://<github user>.github.io/my-app\"\r\n```\r\n\r\n- Aos **scripts** existentes adicionamos 2 novos, **predeploy** e **deploy**:\r\n\r\n```{bash}\r\n\"scripts\": {\r\n  //...\r\n  \"predeploy\": \"npm run build\",\r\n  \"deploy\": \"gh-pages -d build\"\r\n}\r\n```\r\n\r\n![5](https://user-images.githubusercontent.com/17366849/79791400-267e1280-8345-11ea-9aa9-2f164576d1ac.png)\r\n\r\n# Criar o repositório no **Github**\r\n\r\nUma vez criada e configurada a aplicação **ReactJS** chega a altura de criarmos o nosso repositório onde vai estar o código fonte da aplicação.\r\n\r\n```{bash}\r\ngit init\r\ngit add .\r\ngit commit -m \"Initialize project using Create React App\"\r\ngit remote add origin https://github.com/<github user>/my-app.git\r\ngit push -u origin master\r\n```\r\n\r\nAgora que temos todo o nosso código no repositório git é altura de fazer o deploy para as páginas do **Github**. Para isso vamos correr o seguinte comando:\r\n\r\n```{bash}\r\nnpm run deploy\r\n```\r\n\r\n![2](https://user-images.githubusercontent.com/17366849/79789636-6c85a700-8342-11ea-850e-29dc4fc0bb3a.png)\r\n\r\nQuando esta etapa terminar podemos verificar no nosso repositório que foi criada uma nova branch chamada **gh-pages**. Isso é bom sinal!\r\nAgora podemos aceder ao url da página do **Github** (<github user>.github.io) e vemos a nossa aplicação a funcionar!\r\n\r\n# Automatizar a tarefa de deploy\r\n\r\nCom a página do **Github** a funcionar passamos ao passo seguinte: realizar esta tarefa de deploy da nossa aplicação sempre que existir novo código. Para isso vamos recorrer às **actions** do **Github**.\r\n\r\n---\r\n## Criar um **Secret**\r\n\r\nPara que a tarefa seja realizada é necessário dar permissões de leitura no nosso repositório através de um **Secret**. Para tal basta:\r\n- Ir à página [Developer settings](https://github.com/settings/tokens) no **Github** **>** Gerar um novo token **>** Ir até à página de **Secrets** do nosso repositório **>** Criar um novo **Secret** com o nome PERSONAL_TOKEN e colocar o valor obtido quando gerámos o token.\r\n---\r\n\r\nCriar um ficheiro na pasta **.github/workflows/masterDeploy.yml** (pode ter outro nome) com o seguinte conteúdo:\r\n\r\n```{yaml}\r\nname: masterDeploy\r\n\r\non:\r\n  push:\r\n    branches:\r\n      - master\r\n\r\njobs:\r\n  deploy:\r\n    runs-on: ubuntu-18.04\r\n    steps:\r\n      - uses: actions/checkout@v2\r\n\r\n      - name: Setup Node\r\n        uses: actions/setup-node@v1\r\n        with:\r\n          node-version: '10.x'\r\n\r\n      - name: Cache dependencies\r\n        uses: actions/cache@v1\r\n        with:\r\n          path: ~/.npm\r\n          key: ${{ runner.os }}-node-${{ hashFiles('package-lock.json') }}\r\n          restore-keys: |\r\n            ${{ runner.os }}-node-\r\n\r\n      - run: npm ci\r\n      - run: npm run build\r\n\r\n      - name: Deploy\r\n        uses: peaceiris/actions-gh-pages@v3\r\n        with:\r\n          user_name: '<github user>'\r\n          user_email: '<github email>'\r\n          personal_token: ${{ secrets.PERSONAL_TOKEN }}\r\n          publish_dir: ./build\r\n```\r\n\r\nCom esta configuração, sempre que houverem commits na branch master do repositório, vai ser realizada um novo deploy da aplicação.\r\n\r\n![6](https://user-images.githubusercontent.com/17366849/79796643-d48dba80-834d-11ea-8479-634aed9002c5.png)\r\n\r\n## Fazer o deploy para um repositório diferente\r\n\r\nNo caso de querermos fazer o deploy da aplicação para um repositório externo, de forma a separar o código fonte do código da aplicação compilada, podemos alterar o ficheiro do workflow da seguinte forma:\r\n\r\n```{yaml}\r\n//...\r\n      - name: Deploy\r\n        uses: peaceiris/actions-gh-pages@v3\r\n        with:\r\n          user_name: '<github user>'\r\n          user_email: '<github email>'\r\n          personal_token: ${{ secrets.PERSONAL_TOKEN }}\r\n          external_repository: <github user>/<github external repository>\r\n          publish_branch: <branch>\r\n          publish_dir: ./build\r\n```\r\n\r\nO website da [minecode](https://minecode.github.io) é um exemplo claro onde fazemos o deploy da aplicação para o repositório **[minecode.github.io](https://github.com/minecode/minecode.github.io)** a partir do código fonte no repositório **[website](https://github.com/minecode/website)**.\r\n\r\nO código gerado neste artigo está disponível [aqui](https://github.com/cfchenr/my-app) e o resultado obtido [aqui](https://cfchenr.github.io/my-app/). ","closed_by":{"login":"cfchenr","id":17366849,"node_id":"MDQ6VXNlcjE3MzY2ODQ5","avatar_url":"https://avatars.githubusercontent.com/u/17366849?v=4","gravatar_id":"","url":"https://api.github.com/users/cfchenr","html_url":"https://github.com/cfchenr","followers_url":"https://api.github.com/users/cfchenr/followers","following_url":"https://api.github.com/users/cfchenr/following{/other_user}","gists_url":"https://api.github.com/users/cfchenr/gists{/gist_id}","starred_url":"https://api.github.com/users/cfchenr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cfchenr/subscriptions","organizations_url":"https://api.github.com/users/cfchenr/orgs","repos_url":"https://api.github.com/users/cfchenr/repos","events_url":"https://api.github.com/users/cfchenr/events{/privacy}","received_events_url":"https://api.github.com/users/cfchenr/received_events","type":"User","site_admin":false},"performed_via_github_app":null},"relatedPosts":[]},"__N_SSG":true}